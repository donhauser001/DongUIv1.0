# 审计目标与范围
- 全面评估前后端代码质量、安全性、可维护性、性能与配置管理现状。
- 输出可执行改进建议与优先级，并形成可溯源的详细审计报告（含证据路径与代码引用）。

## 审计方法
- 静态审阅：阅读关键文件与目录，提取架构、依赖、配置、接口与数据模型。
- 结构化检查清单：按安全、质量、性能、配置、测试、运维六大维度逐项核查。
- 证据化记录：每一问题均给出具体文件路径与行号引用（如 `apps/server/src/main.ts:7-12`）。
- 不进行任何修改与命令执行，先完成审计与计划确认；获得确认后再执行细化检查或优化工作。

## 现状速写（为后续审计提供基础）
- 前端：`Vue 3 + Vite + UnoCSS + Pinia + Vue Router`（端口 `51730`，`/api` 代理后端）。入口 `apps/web/src/main.ts:9-17`，路由 `apps/web/src/router/index.ts:7-85`。
- 后端：`NestJS + Prisma + PostgreSQL(pgvector)`（端口 `50000`）。入口 `apps/server/src/main.ts:4-13`，控制器 `apps/server/src/app.controller.ts:8-18`，配置 API `apps/server/src/config/config.controller.ts:8-16` 与服务 `apps/server/src/config/config.service.ts:8-33`。
- 数据模型：`apps/server/prisma/schema.prisma:30-49` 包含 `Document` 向量索引与 `SystemConfig` JSON 配置。
- 基础设施：`docker-compose.yml:3-27` 暴露数据库与 Redis，默认凭据存在。
- 测试与 CI：暂无测试与 CI 配置。

## 审计维度与检查项
### 安全
- 认证与鉴权：后端未见 JWT/Session/Guard，管理路由无前端路由守卫与权限校验。
- CORS 策略：`apps/server/src/main.ts:7-12` 全量放开，生产需限制来源与凭证策略。
- 输入校验：配置接口缺少 DTO 与 `class-validator` 校验，存在不受控 JSON 写入风险。
- 敏感信息：`docker-compose.yml` 与 `.env` 默认账号密码，需提示安全风险与环境分级管理。
- 前端安全：Axios 默认 `baseURL:'/api'`，缺少 CSRF/重放防护；路由组件中未见 XSS 防护策略说明。

### 代码质量与可维护性
- 模块职责：后端模块清晰，但缺通用异常过滤器与日志拦截器；前端 API 错误提示以 `console.warn` 为主。
- 风格规范：TypeScript/JavaScript 建议统一 ESLint + Prettier（Airbnb 规则），当前未检测到配置。
- 注释与结构：关键模块已有简要注释，建议在服务层与核心流程补充中文注释与函数长度控制（≤50 行）。

### 性能
- 前端：路由已懒加载，建议启用构建分包与缓存策略、UnoCSS 原子类复用检查。
- 后端：`PrismaService` 连接生命周期正确，建议评估连接池、查询索引（尤其向量检索场景）与批量操作。
- 数据库：`Document` 已建立向量索引（`schema.prisma:39-40`），建议对高频查询字段补充普通索引。

### 配置与环境
- 环境变量：`DATABASE_URL` 在 `apps/server/.env`，建议区分 dev/staging/prod 并使用 `.env.example`。
- 运行端口：Vite `51730`、Nest `50000`，代理转发 `apps/web/vite.config.ts:16-26`。
- 配置存储：`SystemConfig` 用于主题配置 JSON，建议添加服务端校验与审计日志。

### 测试
- 前端：建议引入 `vitest + @testing-library/vue`，覆盖路由与组件渲染、主题应用。
- 后端：建议引入 `jest + @nestjs/testing`，覆盖控制器、服务、Prisma 交互与异常路径。

### 运维与基础设施
- Docker：默认凭据与端口暴露需标注风险，建议增加 `healthcheck` 与备份策略说明。
- CI/CD：建议添加 GitHub Actions（安装依赖、构建、Lint、测试、Prisma 校验）。

## 执行步骤（经你确认后按序推进）
1. 目录与架构审阅：梳理工作区、启动脚本、端口与代理配置，整理架构图与说明。
2. 依赖清点与风险分析：列出前后端依赖与版本，规划漏洞扫描（说明如何运行 `pnpm audit`）。
3. 后端安全与质量检查：
   - 控制器/服务层 DTO 与校验缺口清单；异常过滤器与日志拦截器设计草案。
   - CORS 策略与配置项建议（白名单、凭证、暴露头）。
4. 数据库与 Prisma 检查：模型、索引、迁移/推送流程与 `pgvector` 使用评估。
5. 前端安全与质量检查：API 错误处理统一化、路由守卫、XSS/CSRF 风险提示与加固方案。
6. 构建与运行配置评估：Vite 构建优化建议（分包、缓存、Rollup 配置）、代理与本地/生产差异化。
7. 测试与 CI 方案：最小可运行的测试样例计划与 CI pipeline 草案。
8. 汇总与优先级：将问题分为高/中/低优先级，并给出改进工作量与影响评估。
9. 交付审计报告：包含问题列表、证据引用、建议、影响、改进路线与后续工作项。

## 交付物
- 《项目全面审计报告》（Markdown/可导出 PDF）：
  - 概览与架构图
  - 详细问题清单（按维度分组，含证据文件路径）
  - 改进建议与优先级矩阵
  - 测试与 CI 引入建议与最小样例
  - 安全清单与合规建议（含默认凭据风险）

## 风险与注意事项
- 不在审计阶段执行任何对系统有副作用的操作；所有命令与改动在你确认后进行。
- 安全项优先级最高（认证、输入校验、默认凭据与 CORS）。

## 需要你的确认
- 请确认以上审计计划。确认后我将按照步骤执行只读检查与证据采集，并输出详细的审计报告；如你同意，我也可在报告后给出可选的快速修复补丁建议（保持不自动提交）。