# ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ

ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæä¾›å®Œæ•´çš„ç”¨æˆ· CRUD åŠŸèƒ½ï¼Œæ”¯æŒè§’è‰²ç®¡ç†å’ŒçŠ¶æ€æ§åˆ¶ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·åˆ—è¡¨
- âœ… ç”¨æˆ·æœç´¢ï¼ˆå§“å/é‚®ç®±ï¼‰
- âœ… è§’è‰²ç­›é€‰
- âœ… çŠ¶æ€ç­›é€‰
- âœ… å®æ—¶çŠ¶æ€åˆ‡æ¢
- âœ… ç”¨æˆ·åˆ é™¤

### 2. ç”¨æˆ·è¯¦æƒ…
- âœ… æŸ¥çœ‹ç”¨æˆ·å®Œæ•´ä¿¡æ¯
- âœ… ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
- âœ… è§’è‰²ç®¡ç†
- âœ… çŠ¶æ€ç®¡ç†

### 3. è§’è‰²ç³»ç»Ÿ
- **å­¦ç”Ÿ (STUDENT)**: é»˜è®¤è§’è‰²
- **æ•™å¸ˆ (TEACHER)**: æ•™å¸ˆæƒé™
- **ç®¡ç†å‘˜ (ADMIN)**: ç®¡ç†å‘˜æƒé™
- **è¶…çº§ç®¡ç†å‘˜ (SUPER_ADMIN)**: æœ€é«˜æƒé™ï¼Œå—ä¿æŠ¤è§’è‰²

### 4. è§’è‰²ä¿æŠ¤æœºåˆ¶
- âœ… **è¶…çº§ç®¡ç†å‘˜ä¸å¯åˆ é™¤**: åˆ—è¡¨ä¸­è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·æ˜¾ç¤º"ä¸å¯åˆ é™¤"æ ‡è¯†
- âœ… **è¶…çº§ç®¡ç†å‘˜è§’è‰²ä¸å¯ä¿®æ”¹**: ç¼–è¾‘é¡µé¢ä¸­è§’è‰²é€‰æ‹©å™¨è¢«ç¦ç”¨
- âœ… **è¶…çº§ç®¡ç†å‘˜å¯ç¼–è¾‘å…¶ä»–ä¿¡æ¯**: å§“åã€é‚®ç®±ã€å¤´åƒç­‰ä¿¡æ¯ä»å¯ä¿®æ”¹
- âœ… **å…¶ä»–è§’è‰²å¯æ­£å¸¸åˆ é™¤å’Œç¼–è¾‘**: å­¦ç”Ÿã€æ•™å¸ˆã€ç®¡ç†å‘˜è§’è‰²æ— é™åˆ¶

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯åŠ¨æ•°æ®åº“

é¦–å…ˆéœ€è¦å¯åŠ¨ PostgreSQL æ•°æ®åº“ï¼š

\`\`\`bash
# ä½¿ç”¨ Docker Compose å¯åŠ¨
docker-compose up -d
\`\`\`

### è¿è¡Œæ•°æ®åº“è¿ç§»

\`\`\`bash
cd apps/server

# ç”Ÿæˆ Prisma Client
pnpm prisma generate

# è¿è¡Œè¿ç§»ï¼ˆéœ€è¦åœ¨äº¤äº’å¼ç»ˆç«¯ä¸­ï¼‰
pnpm prisma migrate dev --name add_user_fields
\`\`\`

### å¯åŠ¨æœåŠ¡

\`\`\`bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm -r run dev
\`\`\`

## ğŸ“¡ API æ¥å£

### è·å–ç”¨æˆ·åˆ—è¡¨

\`\`\`typescript
GET /api/users?search=xxx&role=STUDENT&status=true
\`\`\`

**æŸ¥è¯¢å‚æ•°**:
- `search`: æœç´¢å…³é”®è¯ï¼ˆå§“å/é‚®ç®±ï¼‰
- `role`: è§’è‰²ç­›é€‰ï¼ˆSTUDENT/TEACHER/ADMIN/SUPER_ADMINï¼‰
- `status`: çŠ¶æ€ç­›é€‰ï¼ˆtrue/falseï¼‰

### è·å–å•ä¸ªç”¨æˆ·

\`\`\`typescript
GET /api/users/:id
\`\`\`

### åˆ›å»ºç”¨æˆ·

\`\`\`typescript
POST /api/users

{
  "email": "user@example.com",
  "name": "å¼ ä¸‰",
  "password": "password123",
  "role": "STUDENT",
  "avatar": "https://..."
}
\`\`\`

### æ›´æ–°ç”¨æˆ·

\`\`\`typescript
PUT /api/users/:id

{
  "name": "æå››",
  "email": "new@example.com",
  "role": "TEACHER",
  "status": true
}
\`\`\`

**é™åˆ¶**:
- âŒ è¶…çº§ç®¡ç†å‘˜çš„è§’è‰²ä¸å¯ä¿®æ”¹
- âœ… è¶…çº§ç®¡ç†å‘˜çš„å…¶ä»–ä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ç­‰ï¼‰å¯ä¿®æ”¹
- âœ… å…¶ä»–è§’è‰²ç”¨æˆ·å¯æ­£å¸¸ä¿®æ”¹æ‰€æœ‰ä¿¡æ¯

### åˆ‡æ¢ç”¨æˆ·çŠ¶æ€

\`\`\`typescript
PATCH /api/users/:id/toggle-status
\`\`\`

### åˆ é™¤ç”¨æˆ·

\`\`\`typescript
DELETE /api/users/:id
\`\`\`

**é™åˆ¶**:
- âŒ è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·ä¸å¯åˆ é™¤
- âœ… å…¶ä»–è§’è‰²ç”¨æˆ·å¯æ­£å¸¸åˆ é™¤

### è·å–ç”¨æˆ·ç»Ÿè®¡

\`\`\`typescript
GET /api/users/stats

// è¿”å›
{
  "total": 100,
  "active": 95,
  "inactive": 5,
  "byRole": [
    { "role": "STUDENT", "count": 80 },
    { "role": "TEACHER", "count": 15 },
    { "role": "ADMIN", "count": 5 }
  ]
}
\`\`\`

## ğŸ’» å‰ç«¯ä½¿ç”¨

### å¯¼å…¥ API

\`\`\`typescript
import { 
  getUsers, 
  getUser, 
  createUser, 
  updateUser, 
  deleteUser,
  toggleUserStatus,
  getUserStats,
  ROLE_NAMES
} from '@/api/user'
\`\`\`

### è·å–ç”¨æˆ·åˆ—è¡¨

\`\`\`typescript
const users = await getUsers({
  search: 'å¼ ä¸‰',
  role: 'STUDENT',
  status: true
})
\`\`\`

### åˆ›å»ºç”¨æˆ·

\`\`\`typescript
const newUser = await createUser({
  email: 'user@example.com',
  name: 'å¼ ä¸‰',
  password: 'password123',
  role: 'STUDENT'
})
\`\`\`

### æ›´æ–°ç”¨æˆ·

\`\`\`typescript
const updated = await updateUser(userId, {
  name: 'æå››',
  role: 'TEACHER'
})
\`\`\`

### åˆ‡æ¢çŠ¶æ€

\`\`\`typescript
const updated = await toggleUserStatus(userId)
\`\`\`

### è§’è‰²åç§°æ˜ å°„

\`\`\`typescript
import { ROLE_NAMES } from '@/api/user'

console.log(ROLE_NAMES['STUDENT'])      // "å­¦ç”Ÿ"
console.log(ROLE_NAMES['TEACHER'])      // "æ•™å¸ˆ"
console.log(ROLE_NAMES['ADMIN'])        // "ç®¡ç†å‘˜"
console.log(ROLE_NAMES['SUPER_ADMIN'])  // "è¶…çº§ç®¡ç†å‘˜"
\`\`\`

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

\`\`\`prisma
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String   // å¯†ç å“ˆå¸Œ
  avatar    String?  // å¤´åƒ URL
  role      Role     @default(STUDENT)
  status    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  STUDENT      // å­¦ç”Ÿ
  TEACHER      // æ•™å¸ˆ
  ADMIN        // ç®¡ç†å‘˜
  SUPER_ADMIN  // è¶…çº§ç®¡ç†å‘˜
}
\`\`\`

## ğŸ”’ å®‰å…¨æ€§

### å¯†ç åŠ å¯†

æ‰€æœ‰å¯†ç ä½¿ç”¨ bcrypt è¿›è¡ŒåŠ å¯†ï¼š

\`\`\`typescript
import * as bcrypt from 'bcrypt'

// åŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10)

// éªŒè¯å¯†ç 
const isValid = await bcrypt.compare(password, hashedPassword)
\`\`\`

### æ•°æ®éªŒè¯

- âœ… é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
- âœ… å¯†ç å¼ºåº¦è¦æ±‚ï¼ˆå‰ç«¯ï¼‰
- âœ… è¶…çº§ç®¡ç†å‘˜ä¿æŠ¤æœºåˆ¶
- âœ… è§’è‰²ä¿®æ”¹é™åˆ¶
- â³ è§’è‰²æƒé™éªŒè¯ï¼ˆå¾…å®ç°ï¼‰

## ğŸ¨ UI ç»„ä»¶

### ç”¨æˆ·åˆ—è¡¨é¡µé¢

è·¯å¾„: `/admin/user/list`

**åŠŸèƒ½**:
- æœç´¢å’Œç­›é€‰
- çŠ¶æ€åˆ‡æ¢å¼€å…³
- è§’è‰²å¾½ç« æ˜¾ç¤º
- æ“ä½œæŒ‰é’®ï¼ˆè¯¦æƒ…/åˆ é™¤ï¼‰
- è¶…çº§ç®¡ç†å‘˜åˆ é™¤ä¿æŠ¤

### ç”¨æˆ·è¯¦æƒ…é¡µé¢

è·¯å¾„: `/admin/user/detail/:id`

**åŠŸèƒ½**:
- ç”¨æˆ·ä¿¡æ¯å±•ç¤º
- ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
- è¡¨å•éªŒè¯
- ä¿å­˜æ›´æ”¹
- è¶…çº§ç®¡ç†å‘˜è§’è‰²ä¿æŠ¤

## ğŸš§ å¾…å®ç°åŠŸèƒ½

- [ ] ç”¨æˆ·åˆ›å»ºé¡µé¢
- [ ] æ‰¹é‡æ“ä½œ
- [ ] å¯¼å…¥/å¯¼å‡ºç”¨æˆ·
- [ ] ç”¨æˆ·æƒé™ç®¡ç†
- [ ] ç™»å½•æ—¥å¿—
- [ ] å¯†ç é‡ç½®
- [ ] é‚®ç®±éªŒè¯

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®ç»“æ„](../01_è§„èŒƒæŒ‡å—/01_é¡¹ç›®ç»“æ„.md)
- [API æ¥å£è§„èŒƒ](../01_è§„èŒƒæŒ‡å—/02_Gitè§„èŒƒ.md)
- [UI è®¾è®¡è§„èŒƒ](../01_è§„èŒƒæŒ‡å—/03_UIè®¾è®¡è§„èŒƒ.md)

---

**æœ€åæ›´æ–°**: 2024-11-24

