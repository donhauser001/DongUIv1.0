# 角色管理系统

## 概述

角色管理系统提供了完整的 CRUD 功能，支持动态创建、编辑和删除角色，并自动统计每个角色下的用户数量。

## 功能特性

### 1. 角色列表

- **卡片式展示**: 每个角色以卡片形式展示，包含图标、名称、标识、描述和用户数量
- **系统角色标记**: 系统角色带有"系统"徽章，不可删除
- **悬停操作**: 鼠标悬停时显示编辑和删除按钮
- **实时统计**: 显示每个角色下的用户数量

### 2. 新增角色

点击"新增角色"按钮，在模态窗中填写：

- **角色名称** (必填): 如"运营经理"
- **角色标识** (必填): 如"OPERATION_MANAGER"（建议使用大写字母和下划线）
- **角色描述** (可选): 描述该角色的职责和权限

### 3. 编辑角色

点击角色卡片上的编辑按钮：

- **系统角色**: 可编辑名称和描述，但标识不可修改
- **自定义角色**: 可完全编辑所有字段

### 4. 删除角色

点击角色卡片上的删除按钮：

- **系统角色**: 不可删除
- **有用户的角色**: 不可删除，需先重新分配用户
- **空角色**: 确认后可删除

## 系统角色

系统预置了四个默认角色：

| 角色名称 | 角色标识 | 描述 | 可删除 |
|---------|---------|------|--------|
| 超级管理员 | SUPER_ADMIN | 拥有系统所有权限 | ❌ |
| 管理员 | ADMIN | 管理系统配置、用户管理 | ❌ |
| 教师 | TEACHER | 管理课程、查看学生信息 | ❌ |
| 学生 | STUDENT | 查看课程、提交作业 | ❌ |

## 使用场景

### 场景 1: 创建新角色

```typescript
// 示例：创建"内容编辑"角色
{
  name: '内容编辑',
  key: 'CONTENT_EDITOR',
  description: '负责内容审核和发布'
}
```

### 场景 2: 编辑角色信息

```typescript
// 更新角色描述
{
  description: '负责内容审核、发布和数据分析'
}
```

### 场景 3: 删除未使用的角色

1. 确认该角色下没有用户
2. 点击删除按钮
3. 确认删除操作

## API 接口

### 获取所有角色

```typescript
import { getRoles } from '@/api/role'

const roles = await getRoles()
// 返回: Role[]
```

### 创建角色

```typescript
import { createRole } from '@/api/role'

const newRole = await createRole({
  name: '运营经理',
  key: 'OPERATION_MANAGER',
  description: '管理订单、查看数据报表'
})
```

### 更新角色

```typescript
import { updateRole } from '@/api/role'

await updateRole(roleId, {
  name: '高级运营经理',
  description: '管理订单、查看数据报表、团队管理'
})
```

### 删除角色

```typescript
import { deleteRole } from '@/api/role'

await deleteRole(roleId)
```

## 数据结构

### Role 接口

```typescript
interface Role {
  id: string              // 角色ID
  name: string            // 角色名称
  key: string             // 角色标识（唯一）
  description?: string    // 角色描述
  isSystem: boolean       // 是否为系统角色
  userCount: number       // 用户数量
  createdAt: string       // 创建时间
  updatedAt: string       // 更新时间
}
```

### CreateRoleDto 接口

```typescript
interface CreateRoleDto {
  name: string            // 角色名称
  key: string             // 角色标识
  description?: string    // 角色描述
}
```

### UpdateRoleDto 接口

```typescript
interface UpdateRoleDto {
  name?: string           // 角色名称
  key?: string            // 角色标识
  description?: string    // 角色描述
}
```

## 样式定制

角色管理页面使用全局主题变量，可在"组件画廊"中统一配置：

- **卡片样式**: 使用 `card-base` 类，受卡片设置控制
- **按钮样式**: 使用 `btn-primary` 类，受按钮设置控制
- **表单样式**: 使用 `input-base` 和 `textarea-base` 类，受输入框设置控制
- **模态窗样式**: 使用 `Modal` 组件，受模态窗设置控制

## 权限控制

### 系统角色保护

```typescript
// 系统角色不可删除
if (role.isSystem) {
  alert('系统角色不可删除')
  return
}
```

### 用户关联检查

```typescript
// 有用户的角色不可删除
if (role.userCount > 0) {
  alert(`该角色下有 ${role.userCount} 个用户，请先重新分配用户角色`)
  return
}
```

## 注意事项

1. **角色标识规范**
   - 建议使用大写字母和下划线
   - 例如：`OPERATION_MANAGER`, `CONTENT_EDITOR`
   - 标识必须唯一

2. **系统角色限制**
   - 系统角色不可删除
   - 系统角色的标识不可修改
   - 但可以修改系统角色的名称和描述

3. **删除限制**
   - 有用户关联的角色不可删除
   - 删除前需确认操作
   - 删除后无法恢复

4. **用户分配**
   - 删除角色前，需先将该角色下的用户重新分配到其他角色
   - 可在用户管理页面进行批量操作

## 常见问题

### Q: 如何批量创建角色？

A: 可以通过 API 循环调用 `createRole` 方法，或直接在数据库中插入数据。

### Q: 可以恢复已删除的角色吗？

A: 不可以。删除操作是永久性的，建议删除前做好备份。

### Q: 系统角色可以重命名吗？

A: 可以修改系统角色的名称和描述，但不能修改标识（key）。

### Q: 角色数量有限制吗？

A: 没有硬性限制，但建议保持角色数量在合理范围内，便于管理。

## 相关文档

- [用户管理系统](./11_用户系统完整指南.md)
- [模态窗组件](./12_模态窗组件.md)
- [数据库迁移指南](../../../ROLE_MIGRATION.md)

## 更新日志

### v1.0.0 (2025-11-24)
- ✨ 初始版本发布
- ✨ 支持角色 CRUD 操作
- ✨ 系统角色保护机制
- ✨ 用户数量统计
- ✨ 完整的前后端集成

